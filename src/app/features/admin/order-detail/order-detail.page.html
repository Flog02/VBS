<!-- src/app/features/admin/order-detail/order-detail.page.html -->
<app-header></app-header>

<ion-content>
  <div class="admin-container">
    <!-- Back Navigation -->
    <div class="back-link">
      <ion-button fill="clear" routerLink="/admin/orders">
        <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
        Back to Orders
      </ion-button>
    </div>
    
    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="loading-container">
      <app-loading-spinner message="Loading order details..."></app-loading-spinner>
    </div>
    
    <!-- Order Details -->
    <div *ngIf="!isLoading && order" class="order-details">
      <div class="order-header">
        <div class="order-title">
          <h1>Order #{{ order.id.substring(0, 8) }}</h1>
          <div class="order-badges">
            <ion-badge [ngClass]="getStatusClass(order.status)">
              {{ order.status }}
            </ion-badge>
            <ion-badge [ngClass]="getPaymentStatusClass(order.paymentStatus)">
              {{ order.paymentStatus }}
            </ion-badge>
          </div>
        </div>
        
        <div class="order-actions">
          <ion-button color="primary" (click)="printOrder()">
            <ion-icon name="print-outline" slot="start"></ion-icon>
            Print
          </ion-button>
          
          <ion-button color="tertiary">
            <ion-icon name="mail-outline" slot="start"></ion-icon>
            Email
          </ion-button>
        </div>
      </div>
      
      <ion-grid>
        <ion-row>
          <!-- Order Summary and Status Management -->
          <ion-col size="12" size-md="4">
            <ion-card>
              <ion-card-header>
                <ion-card-title>Order Summary</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <div class="summary-item">
                  <div class="summary-label">Order Date</div>
                  <div class="summary-value">{{ formatDate(order.createdAt) }}</div>
                </div>
                
                <div class="summary-item">
                  <div class="summary-label">Last Updated</div>
                  <div class="summary-value">{{ formatDate(order.updatedAt) }}</div>
                </div>
                
                <div class="summary-item">
                  <div class="summary-label">Payment Method</div>
                  <div class="summary-value">{{ order.paymentMethod }}</div>
                </div>
                
                <div class="summary-item">
                  <div class="summary-label">Payment Status</div>
                  <div class="summary-value">
                    <ion-badge [ngClass]="getPaymentStatusClass(order.paymentStatus)">
                      {{ order.paymentStatus }}
                    </ion-badge>
                  </div>
                </div>
                
                <div class="summary-item">
                  <div class="summary-label">Order Status</div>
                  <div class="summary-value">
                    <ion-select 
                      interface="popover" 
                      [(ngModel)]="selectedStatus"
                      (ionChange)="confirmStatusUpdate()">
                      <ion-select-option *ngFor="let option of statusOptions" [value]="option.value">
                        {{ option.label }}
                      </ion-select-option>
                    </ion-select>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
            
            <!-- Customer Information -->
            <ion-card *ngIf="customer">
              <ion-card-header>
                <ion-card-title>Customer Information</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <div class="customer-info">
                  <div class="customer-name">{{ customer.displayName || 'Not Set' }}</div>
                  <div class="customer-email">{{ customer.email }}</div>
                  <div class="customer-phone" *ngIf="customer.phoneNumber">{{ customer.phoneNumber }}</div>
                  
                  <div class="customer-address" *ngIf="customer.address">
                    <h3>Address</h3>
                    <p>{{ customer.address.street }}</p>
                    <p>{{ customer.address.city }}, {{ customer.address.state }} {{ customer.address.zip }}</p>
                    <p>{{ customer.address.country }}</p>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>
          
          <!-- Order Details -->
          <ion-col size="12" size-md="8">
            <!-- Order Items -->
            <ion-card>
              <ion-card-header>
                <ion-card-title>Order Items</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <div class="order-items">
                  <div class="table-responsive">
                    <table class="items-table">
                      <thead>
                        <tr>
                          <th>Product</th>
                          <th>Price</th>
                          <th>Quantity</th>
                          <th>Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let item of order.items">
                          <td class="product-cell">
                            <div class="product-info">
                              <div class="product-image">
                                <img [src]="item.productImage || 'assets/images/product-placeholder.png'" [alt]="item.productName">
                              </div>
                              <div class="product-details">
                                <h3>{{ item.productName }}</h3>
                                <p>Product ID: {{ item.productId.substring(0, 8) }}</p>
                              </div>
                            </div>
                          </td>
                          <td>{{ formatCurrency(item.price) }}</td>
                          <td>{{ item.quantity }}</td>
                          <td>{{ formatCurrency(item.price * item.quantity) }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
            
            <!-- Order Totals -->
            <ion-card>
              <ion-card-header>
                <ion-card-title>Order Totals</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <div class="order-totals">
                  <div class="total-row">
                    <div class="total-label">Subtotal</div>
                    <div class="total-value">{{ formatCurrency(order.subtotal) }}</div>
                  </div>
                  
                  <div class="total-row">
                    <div class="total-label">Tax</div>
                    <div class="total-value">{{ formatCurrency(order.tax) }}</div>
                  </div>
                  
                  <div class="total-row grand-total">
                    <div class="total-label">Total</div>
                    <div class="total-value">{{ formatCurrency(order.total) }}</div>
                  </div>